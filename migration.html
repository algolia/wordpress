<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Migration Best Practices</title>
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta charset="utf-8">
  <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">

  <meta content='How to promote the plugin from dev to staging and from staging to production.' name='description'>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'>
  <!-- / Twitter card -->
  <meta content='summary_large_image' name='twitter:card'>
  <meta content='@Algolia' name='twitter:site'>
  <meta content='@Algolia' name='twitter:creator'>
  <meta content="Migration Best Practices - Algolia Search plugin for WordPress" name="twitter:title">
  <meta content="How to promote the plugin from dev to staging and from staging to production." name="twitter:description">
  <meta content="https://community.algolia.com/wordpress/img/og-screen.png" name="twitter:image">
  <!--meta content="Algolia Product image" name="twitter:image"-->
  <!-- / OG meta -->
  <meta content='https://community.algolia.com/wordpress/' property='og:url'>
  <meta content='https://community.algolia.com/wordpress/img/og-screen.png' property='og:image'>
  <meta content='Migration Best Practices - Algolia Search plugin for WordPress' property='og:title'>
  <meta content='article' property='og:type'>
  <meta content='How to promote the plugin from dev to staging and from staging to production.' property='og:description'>
  <meta content='Algolia Search plugin for WordPress' property='og:site_name'>
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <meta name="description" content="How to promote the plugin from dev to staging and from staging to production.">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/github.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundicons/3.0.0/foundation-icons.min.css">
  <link rel="stylesheet" href="css/app.css?v=1475434160220">

  <link href='https://fonts.googleapis.com/css?family=Raleway:400,500,600' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
  <!-- at the end of the BODY -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
</head>
<body class="">
  <div class='ac-nav'>
    <div class='ac-nav-container'>
      <div class='ac-nav-brand'>
        <a class='ac-logo' href='https://community.algolia.com/' title='Algolia Community'>
          <img alt='Algolia Community' class='ac-logo__lg' src='https://res.cloudinary.com/hilnmyskv/image/upload/logo-community-inline-dark.svg' width='150'>
          <img alt='Algolia Community' class='ac-logo__sm' src='https://res.cloudinary.com/hilnmyskv/image/upload/v1461180081/logo-community-sm.svg'>
        </a>
        <span class='ac-nav-brand-breadcrumb'></span>
        <a class='ac-nav-brand-title' href='./' title='Home'>WordPress <span class="desktop-only">plugin</span></a>
      </div>
      <div class='ac-nav-menu'>
        <div class='ac-nav-searchbox'>
          <div class='svg-icons' style='height: 0; width: 0; position: absolute; visibility: hidden'>
            <svg xmlns='http://www.w3.org/2000/svg'>
              <symbol id="sbx-icon-clear-3" viewBox="0 0 40 40"><path d="M16.228 20L1.886 5.657 0 3.772 3.772 0l1.885 1.886L20 16.228 34.343 1.886 36.228 0 40 3.772l-1.886 1.885L23.772 20l14.342 14.343L40 36.228 36.228 40l-1.885-1.886L20 23.772 5.657 38.114 3.772 40 0 36.228l1.886-1.885L16.228 20z" fill-rule="evenodd"/></symbol>
              <symbol id="sbx-icon-search-13" viewBox="0 0 12 12"><path d="M12 11.077c0-.245-.1-.483-.267-.65L9.26 7.955c.584-.843.894-1.853.894-2.877C10.154 2.272 7.882 0 5.077 0S0 2.272 0 5.077s2.272 5.077 5.077 5.077c1.024 0 2.034-.31 2.877-.894l2.474 2.466c.166.173.404.274.65.274.504 0 .922-.418.922-.923zm-3.692-6c0 1.78-1.45 3.23-3.23 3.23-1.782 0-3.232-1.45-3.232-3.23s1.45-3.23 3.23-3.23c1.782 0 3.232 1.45 3.232 3.23z" fill="#FFF" fill-rule="evenodd" opacity="0.85"/></symbol>
            </svg>
          </div>
        </div>
        <ul class='ac-nav-menu-list'>
          <li class="ac-nav-menu-list-item active">
            <a href="installation.html" data-path="installation.html" title="Documentation">Documentation</a>
          </li>
          <li class="ac-nav-menu-list-item">
            <a href="frequently-asked-questions.html" data-path="frequently-asked-questions.html" title="FAQ">FAQ</a>
          </li>
          <li class='ac-nav-menu-list-icon'>
            <a class='ac-icon' href='https://github.com/algolia/algoliasearch-wordpress/' data-path="https://github.com/algolia/algoliasearch-wordpress/" title='GitHub repository'>
              <span class='ac-icon ac-icon-github'></span>
            </a>
          </li>
        </ul>
      </div>
    </div>

  </div>
<div class="doc">

<header id="top-section" class="doc-header">
    <div class="row row-doc">
        <div class="large-12 columns">
            <a href="./">
                <img class="header-logo" src="https://res.cloudinary.com/hilnmyskv/image/upload/logo-algolia-dark.png">
            </a>
            <p class="lead header-lead">
                Plugin for
                <span>WordPress</span>
            </p>
        </div>
    </div>
</header>

<div class="row m-a">
    <div class="medium-9 large-9 medium-push-3 large-push-3 columns">

        <article>
            <div id="algolia-search">
                <input type="text" id="algolia-search-input" placeholder="Search anywhere in the documentation...">
                <svg id="search-icon" width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M26.424 31.143a2 2 0 0 1 .004-2.824l1.12-1.12a2 2 0 0 1 2.824-.005l-3.948 3.948zm5.01-2.886l7.02 7.018a2 2 0 0 1 0 2.83l-1.12 1.12a2 2 0 0 1-2.83 0l-7.018-7.02 3.95-3.948zm-16.012 2.587c8.517 0 15.422-6.905 15.422-15.422S23.94 0 15.422 0 0 6.905 0 15.422s6.905 15.422 15.422 15.422zm0-3.856c6.388 0 11.566-5.178 11.566-11.566 0-6.388-5.178-11.567-11.566-11.567-6.388 0-11.567 5.18-11.567 11.567 0 6.388 5.18 11.566 11.567 11.566z" fill-rule="evenodd"/></svg>
                <svg id="search-clear-icon"width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M16.228 20L1.886 5.657 0 3.772 3.772 0l1.885 1.886L20 16.228 34.343 1.886 36.228 0 40 3.772l-1.886 1.885L23.772 20l14.342 14.343L40 36.228 36.228 40l-1.885-1.886L20 23.772 5.657 38.114 3.772 40 0 36.228l1.886-1.885L16.228 20z" fill-rule="evenodd"/></svg>
            </div>

            <header>
                <h1>Migration Best Practices</h1>

                <p class="lead">How to promote the plugin from dev to staging and from staging to production.</p>
            </header>

            <hr>

            <div class="row">
                <div class="large-12 columns" id="content">
                    <h2 id="introduction"><a class="heading-anchor" href="#introduction"><span></span></a>Introduction</h2>
<p>It is a common practice to run your website changes on a development or staging environment before pushing them to production.</p>
<p>The Algolia plugin for WordPress requires you to take some additional steps in order to work properly once promoted.</p>
<p>First we have to understand some of the challenges.</p>
<h2 id="full-urls-are-indexed"><a class="heading-anchor" href="#full-urls-are-indexed"><span></span></a>Full URLS are indexed</h2>
<p>When indexing content, we always index full URLS to allow every plugin to be able to intervene in the generation process.
We can not simply remove the domain name of URLS, because one website might use a CDN strategy for example.</p>
<div class="alert alert-warning">You will always need to re-index all your content from your production environment to update all URLS, otherwise the results will point to your staging environment.</div>

<h2 id="use-index-prefixes-to-allow-multiple-websites-on-a-same-algolia-account"><a class="heading-anchor" href="#use-index-prefixes-to-allow-multiple-websites-on-a-same-algolia-account"><span></span></a>Use index prefixes to allow multiple websites on a same Algolia account</h2>
<p>Each index stored in Algolia has a prefix. You should always use a prefix that contains a reference to your current environment&apos;s purpose.</p>
<p>For example, use the following index prefixes to make things obvious:</p>
<ul>
<li><code>mywebsite_prod_</code> =&gt; for production</li>
<li><code>mywebsite_staging_</code> =&gt; for staging</li>
<li><code>mywebsite_dev_</code> =&gt; for development</li>
</ul>
<p>As you might notice, we always also include a unique way to identify the website, here <code>mywebsite_</code>.
By doing so, you ensure that you will easily identify indices even if you have multiple website bound to a single Algolia account.</p>
<div class="alert alert-info">As rule of thumb, I&apos;d recommend you always use the following pattern for your index prefixes: <code>{websitename}_{environment}_</code>.</div>
<div class="alert alert-warning">Don&apos;t forget the trailing underscore; <code>_</code>; if you want your index names to stay readable in the Algolia dashboard.</div>

<h2 id="avoid-breaking-frontend-search"><a class="heading-anchor" href="#avoid-breaking-frontend-search"><span></span></a>Avoid breaking frontend search</h2>
<p>There are several situations where your frontend implementations might break if you don&apos;t take some precautions.</p>
<p>Here are some situations where the frontend might break:</p>
<ul>
<li>If your templates rely on newly indexed fields that have not been pushed yet</li>
<li>If you upgrade the plugin and there is a mention of a breaking change on the plugin</li>
<li>If you customize the data pushed to Algolia by the means of filter hooks</li>
<li>If you install a plugin that uses filter hooks to customize the data pushed to Algolia</li>
</ul>
<p><strong>To avoid search downtime, we recommend you always make sure your website works fine when disabling Algolia.</strong></p>
<p>You should be able to disable the <code>autocomplete dropdown</code> and the <code>instant search results page</code> experiences without breaking your website.</p>
<p>This is the default behaviour if you use the template overriding strategy defined here:</p>
<ul>
<li><a href="customize-autocomplete.html#customization">Override autocomplete template</a></li>
<li><a href="customize-search-page.html#customization">Override search page template</a></li>
</ul>
<div class="alert alert-info">As a best practice, before pushing your implementation to production, we recommend you turn off <code>autocomplete</code> and <code>instant search page</code>. You will be able to re-enable them from the production environment once you made sure your indices are up-to-date with the templates.</div>

<h2 id="from-staging-to-production-steps"><a class="heading-anchor" href="#from-staging-to-production-steps"><span></span></a>From staging to production steps</h2>
<p>To conclude this section, here are the steps to bring the Search by Algolia plugin to production from a staging environment.</p>
<ol>
<li><strong>Make sure you are using a prefix like <code>mywebsite_staging_</code></strong>, and if not, change it on the Indexing page of the plugin,</li>
<li><strong>Disable the autocomplete and instantsearch experiences</strong> to make sure your search still works without Algolia,</li>
<li><strong>Promote your code and your plugin configuration</strong> to production</li>
<li><strong>Update the index name prefix</strong> to <code>mywebsite_production_</code>,</li>
<li><strong>Hit the <span class="wp-btn">Re-index everything</span> button</strong> on the Indexing page of the plugin,</li>
<li><strong>Wait for the indexing to finish</strong> by watching the queue emptying itself (you don&apos;t need to stay on the page though, the queue processing will continue even if you leave the page).</li>
<li><strong>Re-enable to autocomplete and the search page features</strong> of the plugin on the dedicated pages of those features.</li>
</ol>
<p>&#x1F389;You should now have Algolia up and running smoothly in your production environment &#x1F389; !</p>
<div class="alert alert-info">If you experience any problem applying this guide, please reach out to support+wordpress@algolia.com so we can improve it!</div>

                </div>
            </div>

            <ul class="menu simple text-center">
                <li><a href="https://github.com/algolia/algoliasearch-wordpress/edit/master/docs/src/migration.md" target="_blank"><i class="fi-pencil"></i> <span>Edit this Page</span></a></li>
                <li><a href="https://github.com/algolia/algoliasearch-wordpress/issues/new?title=%5BMigration Best Practices%5D%20ISSUE%20NAME%20HERE" target="_blank"><i class="fi-social-github"></i> <span>Report a Bug</span></a></li>
                <li><a href="http://stackoverflow.com/questions/tagged/algolia+wordpress" target="_blank"><i class="fi-comment"></i> <span>Get Help</span></a></li>
            </ul>
        </article>
    </div>

    <div class="medium-3 large-3 medium-pull-9 large-pull-9 columns">
        <ul class="vertical menu" id="main-nav">

            <li class="menu-text">Getting Started</li>
            <li ><a href="installation.html">Installation</a></li>
            <li ><a href="configuration.html">Getting Started</a></li>
            <li ><a href="customize-autocomplete.html">Customize Autocomplete</a></li>
            <li ><a href="customize-search-page.html">Customize Search Page</a></li>

            <li class="menu-text">Indexing</li>
            <li ><a href="index-schema.html">Schemas</a></li>
            <li ><a href="indexing-settings.html">Settings</a></li>
            <li ><a href="indexing-flow.html">Automated Sync.</a></li>
            <li ><a href="synonyms.html">Synonyms</a></li>
            <li ><a href="custom-attributes.html">Custom Attributes</a></li>
            <li ><a href="replicas.html">Index Replicas</a></li>
            <li class="active"><a href="migration.html">Migration Guide</a></li>

            <li class="menu-text">Code References</li>
            <li ><a href="extend-basics.html">Extend & Customize</a></li>
            <li ><a href="constants.html">Constants</a></li>
            <li ><a href="filters.html">Filter Hooks</a></li>
            <li ><a href="actions.html">Action Hooks</a></li>

            <li class="menu-text">Integrations</li>
            <li ><a href="advanced-custom-fields.html">Advanced Custom Fields</a></li>
            <li ><a href="wpml.html">WPML</a></li>

            <li class="menu-text">Theme Development</li>
            <li ><a href="customize-templates.html">Customize Templates</a></li>

            <li class="menu-text">Debugging</li>
            <li ><a href="logs.html">Logs</a></li>
            
            <li class="menu-text">Other</li>
            <li ><a href="internationalization.html">Internationalization</a></li>
            <li ><a href="resources.html">Additional Resources</a></li>
            <li ><a href="contribute.html">Contribute</a></li>
            <li ><a href="frequently-asked-questions.html">FAQ</a></li>
        </ul>
    </div>

</div>
</div>


<script src="vendor/jquery/jquery.js"></script>
<script src="vendor/foundation-sites/foundation.js"></script>
<script src="js/doc.js"></script>

<section class="ac-footer">
  <div class="ac-footer-container">
    <p class="ac-footer-links">
      Code licensed under
      <a class="ac-footer-link-item" href="LICENSE">MIT</a>
      <br/>
      <a class="ac-footer-link-item" href="https://github.com/">Github</a>
      <a class="ac-footer-link-item" href="https://github.com/issues">Issues</a>
      <a class="ac-footer-link-item" href="https://www.algolia.com/policies/privacy">Privacy policy</a>
  </p>
</div>
<div class="ac-footer-container ac-footer-brand">
    <p>This project is part of</p>
    <img class="ac-footer-brand-icon" src="https://res.cloudinary.com/hilnmyskv/image/upload/logo-community.svg"/>
    <figure>
      <img class="ac-footer-brand-logo" src="https://res.cloudinary.com/hilnmyskv/image/upload/v1463417234/algolia-community_n6tixd.svg"/>
      <figcaption>Algolia Community</figcaption>
  </figure>
  <a class="ac-footer-btn ac-footer-btn-cta" href="https://community.algolia.com/">See More</a>
  <span class="ac-icon ac-icon-love-dark"></span>
</div>
<p class="ac-footer-version">Latest version: 1.3.0</p>
<div class="ac-footer-actions">
    <div class="footer-container">
      <p>Build unique search experiences with Algolia</p>
      <a class="ac-footer-btn ac-footer-btn-ghost-grey" href="https://www.algolia.com/why?utm_medium=social-owned&utm_source=places%20website&utm_campaign=homepage&utm_term=why">
        See Why
        <span class="ac-icon-triangle"></span>
    </a>
    <a class="ac-footer-btn ac-footer-btn-ghost-pink" href="https://www.algolia.com/users/sign_up?utm_medium=social-owned&utm_source=places%20website&utm_campaign=homepage&utm_term=get_started">Get Started For Free</a>
</div>
</div>
</section>


<script src="vendor/jquery/jquery.js"></script>
<script src="vendor/foundation-sites/foundation.js"></script>
<script src="js/app.js"></script>
<script src="js/responsiveNavigation.js"></script>
<script async defer src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdn.jsdelivr.net/lodash/4.16.2/lodash.min.js"></script>


    <!-- GA -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-32446386-12', 'auto');
  ga('send', 'pageview');
</script>
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-N8JP8G" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N8JP8G');</script>
<!-- Twitter -->
<script src="//platform.twitter.com/oct.js" type="text/javascript"></script>
<script type="text/javascript">twttr.conversion.trackPid('ntr1j', { tw_sale_amount: 0, tw_order_quantity: 0 });</script>
<noscript>
  <img height="1" width="1" style="display:none;" alt="" src="https://analytics.twitter.com/i/adsct?txn_id=ntr1j&amp;p_id=Twitter&amp;tw_sale_amount=0&amp;tw_order_quantity=0">
  <img height="1" width="1" style="display:none;" alt="" src="//t.co/i/adsct?txn_id=ntr1j&amp;p_id=Twitter&amp;tw_sale_amount=0&amp;tw_order_quantity=0">
</noscript>
<!-- Facebook -->
<script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','//connect.facebook.net/en_US/fbevents.js');
  fbq('init', '1654938174769952');
  fbq('track', "PageView");</script>
<noscript>
  <img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1654938174769952&amp;ev=PageView&amp;noscript=1">
</noscript>
<!-- Addroll -->
<script type="text/javascript">
  adroll_adv_id = "TGR7R4XSGVGYVPX4LQBDFQ";
  adroll_pix_id = "YQNWNHGUUBD2JMY7BVOBWM";
  // adroll_email = "username@example.com"; // OPTIONAL: provide email to improve user identification
  (function () {
    var _onload = function(){
      if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
      if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
      var scr = document.createElement("script");
      var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
      scr.setAttribute('async', 'true');
      scr.type = "text/javascript";
      scr.src = host + "/j/roundtrip.js";
      ((document.getElementsByTagName('head') || [null])[0] ||
        document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
    };
    if (window.addEventListener) {window.addEventListener('load', _onload, false);}
    else {window.attachEvent('onload', _onload)}
  }());
</script>
    

<script type="text/javascript">
    var $searchInput = $("#algolia-search-input");
    if ( $searchInput.length > 0 ) {
        var $searchIcon = $("#search-icon");
        var $clearIcon = $("#search-clear-icon");

        var myDocsearch = docsearch({
            apiKey: '52641df1ce4919ba42eb84595f4825c7',
            indexName: 'wordpress_algolia',
            inputSelector: '#algolia-search-input',
                    debug: false, // Set debug to true if you want to inspect the dropdown
                    autocompleteOptions: {
                        openOnFocus: true
                    }

                });

        $clearIcon.on("click", function() {
            $(".aa-input").focus();
            $clearIcon.hide();
            $searchIcon.fadeIn();
            myDocsearch.autocomplete.autocomplete.setVal("");
        });

        $searchInput.on("keyup", function() {
            if ($searchInput.val().length === 0){
                $clearIcon.hide();
                $searchIcon.fadeIn();
            } else {
                $searchIcon.hide();
                $clearIcon.fadeIn();
            }
        });
    }
</script>
<script>window.twttr = (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0],
      t = window.twttr || {};
      if (d.getElementById(id)) return t;
      js = d.createElement(s);
      js.id = id;
      js.src = "https://platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js, fjs);

      t._e = [];
      t.ready = function(f) {
        t._e.push(f);
      };

      return t;
    }(document, "script", "twitter-wjs"));</script>
</body>
</html>
